import{h as f,s as w,a0 as g,m as d}from"./entry.QCqnk_4_.js";const y=(n,e)=>e.split(".").reduce((i,t)=>i&&i[t],n),p=(n,e)=>Object.keys(n).filter(e).reduce((i,t)=>Object.assign(i,{[t]:n[t]}),{}),P=n=>e=>n&&n.length?p(e,i=>!n.includes(i)):e,T=n=>e=>Array.isArray(e)?e.map(i=>n(i)):n(e),h=n=>{const e=[],i=[];for(const t of n)["$","_"].includes(t)?e.push(t):i.push(t);return{prefixes:e,properties:i}},C=(n=[])=>e=>{if(n.length===0||!e)return e;const{prefixes:i,properties:t}=h(n);return p(e,o=>!t.includes(o)&&!i.includes(o[0]))},O=(n=[])=>e=>{if(n.length===0||!e)return e;const{prefixes:i,properties:t}=h(n);return p(e,o=>t.includes(o)||i.includes(o[0]))},b=(n,e)=>{const i=new Intl.Collator(e.$locale,{numeric:e.$numeric,caseFirst:e.$caseFirst,sensitivity:e.$sensitivity}),t=Object.keys(e).filter(o=>!o.startsWith("$"));for(const o of t)n=n.sort((c,r)=>{const s=[y(c,o),y(r,o)].map(u=>{if(u!==null)return u instanceof Date?u.toISOString():u});return e[o]===-1&&s.reverse(),i.compare(s[0],s[1])});return n},A=(n,e="Expected an array")=>{if(!Array.isArray(n))throw new TypeError(e)},a=n=>Array.isArray(n)?n:[void 0,null].includes(n)?[]:[n],l=["sort","where","only","without"];function E(n,e={}){const i={};for(const r of Object.keys(e.initialParams||{}))i[r]=l.includes(r)?a(e.initialParams[r]):e.initialParams[r];const t=(r,s=u=>u)=>(...u)=>(i[r]=s(...u),c),o=r=>{var s;return e.legacy?r!=null&&r.surround?r.surround:r&&(r!=null&&r.dirConfig&&(r.result={_path:(s=r.dirConfig)==null?void 0:s._path,...r.result,_dir:r.dirConfig}),r!=null&&r._path||Array.isArray(r)||!Object.prototype.hasOwnProperty.call(r,"result")?r:r==null?void 0:r.result):r},c={params:()=>({...i,...i.where?{where:[...a(i.where)]}:{},...i.sort?{sort:[...a(i.sort)]}:{}}),only:t("only",a),without:t("without",a),where:t("where",r=>[...a(i.where),...a(r)]),sort:t("sort",r=>[...a(i.sort),...a(r)]),limit:t("limit",r=>parseInt(String(r),10)),skip:t("skip",r=>parseInt(String(r),10)),find:()=>n(c).then(o),findOne:()=>n(t("first")(!0)).then(o),count:()=>n(t("count")(!0)).then(o),locale:r=>c.where({_locale:r}),withSurround:t("surround",(r,s)=>({query:r,...s})),withDirConfig:()=>t("dirConfig")(!0)};return e.legacy&&(c.findSurround=(r,s)=>c.withSurround(r,s).find().then(o)),c}function m(n){return JSON.stringify(n,v)}function v(n,e){return e instanceof RegExp?`--REGEX ${e.toString()}`:e}const x=n=>{let e=m(n);return e=typeof Buffer<"u"?Buffer.from(e).toString("base64"):btoa(e),e=e.replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,""),(e.match(/.{1,100}/g)||[]).join("/")},k=()=>({isEnabled:()=>{const t=w().query;return Object.prototype.hasOwnProperty.call(t,"preview")&&!t.preview?!1:!!(t.preview||f("previewToken").value||sessionStorage.getItem("previewToken"))},getPreviewToken:()=>f("previewToken").value||sessionStorage.getItem("previewToken")||void 0,setPreviewToken:t=>{f("previewToken").value=t,w().query.preview=t||"",t?sessionStorage.setItem("previewToken",t):sessionStorage.removeItem("previewToken"),window.location.reload()}}),I=n=>g(n,d().public.content.api.baseURL),_=()=>{const{experimental:n}=d().public.content;return n.clientDB?!0:k().isEnabled()};export{A as a,a as b,E as c,b as d,x as e,T as f,y as g,C as h,O as i,m as j,P as o,_ as s,k as u,I as w};
